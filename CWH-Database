<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CWH Database - Full Text Visible</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --primary: #1f2937; --accent: #2563eb; --bg: #f3f4f6; --border-color: #d1d5db; --success: #db2777; }
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', Roboto, sans-serif; background-color: var(--bg); margin: 0; padding: 5px; }
        
        .container { 
            background: white; padding: 10px; border-radius: 12px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); 
            width: fit-content; min-width: 100%; margin: auto;
        }
        
        .header-section { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 0 5px; }
        h2 { color: var(--primary); font-size: 1.1rem; margin: 0; border-left: 4px solid var(--accent); padding-left: 8px; }
        #currentDate { font-size: 0.75rem; color: #4b5563; font-weight: 600; }
        
        /* ·ÄÖ·Ä¨·Äû·Ä¨·Ä∏·Äõ·Äæ·Ää·Ä∫·Äõ·ÄÑ·Ä∫ ·Äò·Ä±·Ä∏·ÄÄ·Ä≠·ÄØ Scroll ·ÄÜ·ÄΩ·Ä≤·ÄÄ·Äº·Ää·Ä∑·Ä∫·Äî·Ä≠·ÄØ·ÄÑ·Ä∫·Äõ·Äî·Ä∫ Wrapper */
        .table-wrapper { border-radius: 8px; border: 1px solid var(--border-color); background: white; overflow-x: auto; }
        
        /* table-layout: auto ·ÄÄ ·ÄÖ·Ä¨·Äû·Ä¨·Ä∏·Ä°·Äï·Äº·Ää·Ä∑·Ä∫·Ä°·ÄÖ·ÄØ·Ä∂·Äô·Äº·ÄÑ·Ä∫·Äõ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫ ·Ä°·ÄÄ·ÄΩ·ÄÄ·Ä∫·ÄÄ·Ä≠·ÄØ ·ÄÅ·Äª·Ä≤·Ä∑·Äï·Ä±·Ä∏·Äï·Ä´·Äê·Äö·Ä∫ */
        table { width: 100%; border-collapse: collapse; table-layout: auto; }
        
        thead th { 
            background-color: var(--primary); color: #f3f4f6; text-align: left; 
            padding: 12px 10px; font-size: 0.8rem; font-weight: 600;
            border-right: 1px solid #374151; white-space: nowrap;
        }

        td { 
            border: 1px solid var(--border-color); padding: 12px 10px; 
            color: #111827; font-size: 0.85rem; outline: none;
            font-weight: 700; 
            white-space: nowrap; /* ·ÄÖ·Ä¨·Äû·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Äê·ÄÖ·Ä∫·Äê·Äî·Ä∫·Ä∏·Äê·Ää·Ä∫·Ä∏·Äë·Ä¨·Ä∏·Äû·Ää·Ä∫ */
        }

        /* ·Ä°·ÄÄ·ÄΩ·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏ ·Äñ·ÄØ·Ä∂·Ä∏·Äô·Äî·Ä±·ÄÖ·Ä±·Äõ·Äî·Ä∫ ·Ä°·Äî·Ää·Ä∫·Ä∏·ÄÜ·ÄØ·Ä∂·Ä∏ ·Ä°·ÄÄ·Äª·Äö·Ä∫·Äô·Äª·Ä¨·Ä∏ ·Äû·Äê·Ä∫·Äô·Äæ·Äê·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏ */
        .no-col { width: 50px; text-align: center; }
        .line-col { min-width: 80px; text-align: center; }
        .item-col { min-width: 200px; } 
        .location-col { min-width: 150px; }

        td:focus { background-color: #f8fafc; box-shadow: inset 0 0 0 1.5px var(--accent); }
        tbody tr:nth-child(even) { background-color: #fcfdfe; }

        .controls { display: flex; gap: 8px; margin-top: 15px; padding: 0 5px; }
        .btn { flex: 1; border: none; padding: 12px; border-radius: 8px; font-weight: 700; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 6px; font-size: 0.8rem; color: white; }
        .add-btn { background-color: var(--accent); }
        .png-btn { background-color: var(--success); }

        .popup-menu { position: absolute; background: white; border: 1px solid var(--border-color); box-shadow: 0 4px 15px rgba(0,0,0,0.1); z-index: 1000; display: none; border-radius: 8px; width: 200px; max-height: 250px; overflow-y: auto; }
        .menu-item { padding: 12px; cursor: pointer; border-bottom: 1px solid #f3f4f6; font-size: 0.85rem; font-weight: 600; color: #1f2937; }
        .menu-item:hover { background-color: #ebf5ff; }
    </style>
</head>
<body>

<div id="captureArea" class="container">
    <div class="header-section">
        <h2>CWH Database</h2>
        <div id="currentDate"></div>
    </div>

    <div class="table-wrapper">
        <table id="mainTable">
            <thead>
                <tr>
                    <th class="no-col">No</th>
                    <th class="line-col" onclick="showFilter(1, event)">Line ‚ñº</th>
                    <th class="item-col" onclick="showFilter(2, event)">Item ‚ñº</th>
                    <th class="location-col">Location</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
        <div id="customPopup" class="popup-menu"></div>
    </div>

    <div class="controls" data-html2canvas-ignore>
        <button class="btn add-btn" onclick="addFiveRows()">+ Add 5 Rows</button>
        <button class="btn png-btn" onclick="downloadPNG()">üì∏ Save PNG</button>
    </div>
</div>

<script>
    const d = new Date();
    document.getElementById('currentDate').innerText = "Date: " + d.getDate() + "/" + (d.getMonth() + 1) + "/" + d.getFullYear();

    const bulkItems = "MB Qt Ctn,MB Qt Crt,Promo MB Qt Ctn,Promo MB Qt Crt,MB Can 500ml,MB Can 330ml,MB Lager Pint Ctn,MB Lager Pint Crt,Mpre Pint Ctn,Mpre Pint Crt,Mpre Can 330ml,MS Can 330ml,BS Can 330ml,BS Qt Ctn,BS Qt Crt,Promo BS Qt Crt,Promo BS Qt Ctn,AG 6.5% Can 330ml,AG 6.5% Can 500ml,Promo AG 6.5% Can 500ml,AG 5% Can 500ml,AG 5% Can 330ml,AG 8.1% Can 500ml,Keen Can 500ml,Keen Can 330ml,Promo Keen 500ml";
    
    const itemsArray = bulkItems.split(",").map(item => item.trim());
    const tbody = document.getElementById('tableBody');
    const popup = document.getElementById('customPopup');

    for (let i = 1; i <= 20; i++) createRow(i);

    function createRow(no) {
        const row = tbody.insertRow();
        row.innerHTML = `<td class="no-col" contenteditable="true">${no}</td><td class="line-col" contenteditable="true"></td><td class="item-col" contenteditable="true" oninput="handleItemInput(this)"></td><td class="location-col" contenteditable="true"></td>`;
    }

    function addFiveRows() {
        for (let i = 0; i < 5; i++) {
            const lastNo = parseInt(tbody.rows[tbody.rows.length-1]?.cells[0].innerText) || 0;
            createRow(lastNo + 1);
        }
    }

    function showFilter(colIndex, event) {
        event.stopPropagation();
        const rows = Array.from(tbody.querySelectorAll('tr'));
        const uniqueValues = [...new Set(rows.map(r => r.cells[colIndex].innerText.trim()))].filter(v => v !== "");
        popup.innerHTML = '';
        uniqueValues.forEach(val => {
            const div = document.createElement('div');
            div.className = 'menu-item'; div.innerText = val;
            div.onclick = () => {
                rows.forEach(r => r.style.display = r.cells[colIndex].innerText.trim() === val ? "" : "none");
                popup.style.display = 'none';
            };
            popup.appendChild(div);
        });
        const rect = event.currentTarget.getBoundingClientRect();
        popup.style.left = rect.left + 'px';
        popup.style.top = (rect.bottom + window.scrollY) + 'px';
        popup.style.display = 'block';
    }

    function handleItemInput(cell) {
        const val = cell.innerText.trim().toLowerCase();
        if (!val) { popup.style.display='none'; return; }
        const matches = itemsArray.filter(i => i.toLowerCase().includes(val));
        if (matches.length > 0) {
            popup.innerHTML = '';
            matches.forEach(m => {
                const div = document.createElement('div');
                div.className = 'menu-item'; div.innerText = m;
                div.onclick = () => { cell.innerText = m; popup.style.display='none'; };
                popup.appendChild(div);
            });
            const rect = cell.getBoundingClientRect();
            popup.style.left = rect.left + 'px';
            popup.style.top = (rect.bottom + window.scrollY) + 'px';
            popup.style.display = 'block';
        } else popup.style.display='none';
    }

    function downloadPNG() {
        const rows = Array.from(tbody.rows);
        const originalDisplays = rows.map(r => r.style.display);
        rows.forEach(row => {
            const hasData = row.cells[1].innerText.trim() !== "" || row.cells[2].innerText.trim() !== "" || row.cells[3].innerText.trim() !== "";
            if (!hasData) row.style.display = 'none';
        });
        html2canvas(document.getElementById("captureArea"), { scale: 3, scrollX: 0, scrollY: -window.scrollY, useCORS: true }).then(canvas => {
            const link = document.createElement('a');
            link.download = `CWH_Report.png`;
            link.href = canvas.toDataURL("image/png");
            link.click();
            rows.forEach((row, i) => row.style.display = originalDisplays[i]);
        });
    }
    document.addEventListener('click', () => popup.style.display = 'none');
</script>

</body>
</html>
